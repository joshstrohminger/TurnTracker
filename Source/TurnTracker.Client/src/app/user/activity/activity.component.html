<div *ngIf="activity" id="activity-wrapper">
  <mat-card>
    <mat-card-header>
      <mat-card-title>{{activity.name}}</mat-card-title>
      <mat-card-subtitle>
        <span *ngIf="activity.periodCount && activity.periodUnit; else noPeriod">{{activity.periodCount}} {{units[activity.periodUnit]}}{{activity.periodCount > 1 ? 's' : ''}}</span>
        <ng-template #noPeriod>indefinite</ng-template>
      </mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <table mat-table [dataSource]="activity.participants" class="padded">
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Person</th>
          <td mat-cell *matCellDef="let participant">{{participant.name}}</td>
        </ng-container>
        <ng-container matColumnDef="turnsNeeded">
          <th mat-header-cell *matHeaderCellDef>Needed</th>
          <td mat-cell *matCellDef="let participant">{{participant.turnsNeeded}}</td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="['name','turnsNeeded']"></tr>
        <tr mat-row *matRowDef="let participant; columns: ['name','turnsNeeded']" [ngClass]="{'accent': participant.userId === myUserId, 'primary': participant.userId === activity.currentTurnUserId, 'warn': participant.userId === activity.currentTurnUserId && activity.overdue}"></tr>
      </table>
    </mat-card-content>
  </mat-card>
  <mat-card>
    <mat-card-header>
      <mat-card-title>Notifications</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <table mat-table [dataSource]="notifications" id="notifications">
        <ng-container matColumnDef="type">
          <th mat-header-cell *matHeaderCellDef>Type</th>
          <td mat-cell *matCellDef="let note">{{note.type | notification}}</td>
        </ng-container>
        <ng-container matColumnDef="sms">
          <th mat-header-cell *matHeaderCellDef class="center">SMS</th>
          <td mat-cell *matCellDef="let note">
            <mat-checkbox [(checked)]="note.sms"></mat-checkbox>
          </td>
        </ng-container>
        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef class="center">E-Mail</th>
          <td mat-cell *matCellDef="let note">
            <mat-checkbox [(checked)]="note.email"></mat-checkbox>
          </td>
        </ng-container>
        <ng-container matColumnDef="push">
          <th mat-header-cell *matHeaderCellDef class="center">Push</th>
          <td mat-cell *matCellDef="let note">
            <mat-checkbox [(checked)]="note.push"></mat-checkbox>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="['type','sms','email','push']"></tr>
        <tr mat-row *matRowDef="let note; columns: ['type','sms','email','push']"></tr>
      </table>
    </mat-card-content>
  </mat-card>
  <div id="turn-list">
    <div *ngIf="activity.turns; else loadTurns">
      <mat-card>
        <mat-card-header>
          <mat-card-title>Turns</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <table mat-table [dataSource]="activity.turns" class="padded">
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>Person</th>
              <td mat-cell *matCellDef="let turn">{{names.get(turn.userId)}}</td>
            </ng-container>
            <ng-container matColumnDef="occurred">
              <th mat-header-cell *matHeaderCellDef>Occurred</th>
              <td mat-cell *matCellDef="let turn">{{turn.occurred | date: 'short'}}</td>
            </ng-container>
            <ng-container matColumnDef="gift">
                <th mat-header-cell *matHeaderCellDef></th>
              <td mat-cell *matCellDef="let turn"><mat-icon *ngIf="turn.userId !== turn.creatorId">cake</mat-icon></td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="['name','occurred','gift']"></tr>
            <tr mat-row *matRowDef="let turn; columns: ['name','occurred','gift']" [ngClass]="{'accent': turn.userId === myUserId}"></tr>
          </table>
        </mat-card-content>
      </mat-card>
    </div>
    <ng-template #loadTurns>
      <button mat-stroked-button color="accent" [disabled]="busy" (click)="refreshActivityWithTurns()" id="load-turns">Load Turns</button>
    </ng-template>
    <div id="bottom-fab-container">
      <button mat-fab color="primary" (click)="takeTurn()" matTooltip="Take Turn" matTooltipPosition="before" [disabled]="busy"><mat-icon>add</mat-icon></button>
      <button mat-mini-fab color="accent" (click)="takeTurnWithOptions()" matTooltip="Take Turn With Options" matTooltipPosition="before" [disabled]="busy"><mat-icon>date_range</mat-icon></button>
    </div>
  </div>
</div>
